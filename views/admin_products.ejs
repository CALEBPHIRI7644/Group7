<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin - Products</title>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="/css/admnProducts.css">
  <style>
   
  </style>
</head>
<body>
  <div class="app">
    <!-- SIDEBAR -->
    <aside class="sidebar mobile-hidden" id="sidebar">
      <div class="brand">
        <span class="logo" aria-hidden="true"></span>
        <div>
          <div class="title">MyShop Admin <span class="pro">PRO</span></div>
          <div class="muted" style="font-size:0.85rem;margin-top:4px">Manage your store</div>
        </div>
      </div>

      <nav class="side-nav" aria-label="Main navigation">
        <a href="/admin/dashboard"><span class="icon"><i class="fa-solid fa-tachometer-alt"></i></span> Dashboard</a>
        <a href="/admin/products" class="active"><span class="icon"><i class="fa-solid fa-box"></i></span> Products</a>
        <a href="/admin/orders"><span class="icon"><i class="fa-solid fa-cart-shopping"></i></span> Orders</a>
        <a href="/admin/users"><span class="icon"><i class="fa-solid fa-users"></i></span> Users</a>
      </nav>

      <div class="sidebar-footer">
        Â© <span id="year"></span> Your Company
      </div>
    </aside>

    <!-- MAIN -->
    <div class="main-wrap">
      <header class="topbar">
        <div class="top-left">
          <button class="hamburger" id="hamburger" title="Open menu">
            <i class="fa-solid fa-bars"></i>
          </button>
          <div class="heading">
            <div class="brand">MyShop Admin</div>
            <div class="subtitle muted">Products</div>
          </div>
        </div>

        <div class="top-actions">
          <div class="search-field" role="search" aria-label="Search">
            <i class="fa-solid fa-magnifying-glass muted"></i>
            <input type="search" placeholder="Search products..." />
          </div>
          <a href="/logout" class="btn-logout">Logout</a>
        </div>
      </header>

      <main>
        <div class="table-box">
          <div class="header page-header">
            <div style="display:flex;align-items:center;gap:12px">
              <div class="page-title">All Products</div>
              <div class="muted" style="font-size:0.9rem">Manage inventory</div>
            </div>
            <div>
              <a href="/admin/products/new" class="add-btn">Add product</a>
            </div>
          </div>

          <div style="padding:16px; overflow-x:auto;">
            <table id="productsTable">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Price</th>
                  <th>Qty</th>
                  <th>Seller</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <% products.forEach(p => { %>
                <tr>
                  <td><%= p.id %></td>
                  <td><%= p.name %></td>
                  <td>$<%= p.price %></td>
                  <td><%= p.quantity %></td>
                  <td><%= p.seller_email %></td>
                  <td class="actions">
                    <!-- data- attributes used to avoid inline JS escaping issues -->
                    <button
                      class="edit-btn"
                      type="button"
                      data-id="<%= p.id %>"
                      data-name="<%= p.name %>"
                      data-price="<%= p.price %>"
                      data-quantity="<%= p.quantity %>"
                      data-seller-email="<%= p.seller_email %>"
                    >
                      Edit
                    </button>

                    <button
                      class="delete-btn"
                      type="button"
                      data-id="<%= p.id %>"
                      data-name="<%= p.name %>"
                    >
                      Delete
                    </button>
                  </td>
                </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- EDIT MODAL -->
  <div id="editBackdrop" class="modal-backdrop" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal" role="document" aria-labelledby="editTitle">
      <h3 id="editTitle">Edit Product</h3>
      <form id="editForm" method="POST" action="">
        <div class="grid">
          <div>
            <label for="editName">Product Name</label>
            <input id="editName" name="name" type="text" required />
          </div>
          <div>
            <label for="editPrice">Price</label>
            <input id="editPrice" name="price" type="number" step="0.01" required />
          </div>
          <div>
            <label for="editQuantity">Quantity</label>
            <input id="editQuantity" name="quantity" type="number" required />
          </div>
          <div>
            <label for="editSeller">Seller Email</label>
            <input id="editSeller" name="seller_email" type="email" required />
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn btn-cancel" id="editCancel">Cancel</button>
          <button type="submit" class="btn btn-primary">Save changes</button>
        </div>
      </form>
    </div>
  </div>

  <!-- DELETE MODAL -->
  <div id="deleteBackdrop" class="modal-backdrop" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal" role="document" aria-labelledby="deleteTitle">
      <h3 id="deleteTitle">Confirm delete</h3>
      <p id="deleteMsg" style="color:#475569;margin-top:6px">Are you sure you want to delete this product?</p>

      <div class="modal-actions" style="margin-top:16px;">
        <form id="deleteForm" method="POST" action="">
          <button type="button" class="btn btn-cancel" id="deleteCancel">Cancel</button>
          <button type="submit" class="btn btn-danger">Yes, delete</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    // fill year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Mobile sidebar toggle
    const sidebar = document.getElementById('sidebar');
    const hamburger = document.getElementById('hamburger');
    hamburger.addEventListener('click', () => {
      if (sidebar.classList.contains('mobile-hidden')) {
        sidebar.classList.remove('mobile-hidden');
        sidebar.style.position = 'fixed';
        sidebar.style.left = '12px';
        sidebar.style.top = '12px';
        sidebar.style.zIndex = 60;
        sidebar.style.height = 'calc(100vh - 24px)';
      } else {
        sidebar.classList.add('mobile-hidden');
        sidebar.style.position = '';
        sidebar.style.left = '';
        sidebar.style.top = '';
        sidebar.style.zIndex = '';
      }
    });

    function handleResize() {
      if (window.innerWidth > 1000) {
        sidebar.classList.remove('mobile-hidden');
        sidebar.style.position = 'sticky';
      } else {
        sidebar.classList.add('mobile-hidden');
      }
    }
    window.addEventListener('resize', handleResize);
    handleResize();

    // Search
    const searchInput = document.querySelector('.search-field input');
    const tableRows = document.querySelectorAll('#productsTable tbody tr');

    searchInput.addEventListener('input', () => {
      const query = searchInput.value.toLowerCase();

      tableRows.forEach(row => {
        const rowText = row.textContent.toLowerCase();
        row.style.display = rowText.includes(query) ? '' : 'none';
      });
    });
  </script>

  <script>
    // Modal elements
    const editBackdrop = document.getElementById('editBackdrop');
    const deleteBackdrop = document.getElementById('deleteBackdrop');

    const editForm = document.getElementById('editForm');
    const editName = document.getElementById('editName');
    const editPrice = document.getElementById('editPrice');
    const editQuantity = document.getElementById('editQuantity');
    const editSeller = document.getElementById('editSeller');
    const editCancel = document.getElementById('editCancel');

    const deleteForm = document.getElementById('deleteForm');
    const deleteMsg = document.getElementById('deleteMsg');
    const deleteCancel = document.getElementById('deleteCancel');

    // Helpers to open/close
    function showModal(backdrop) {
      backdrop.style.display = 'flex';
      backdrop.setAttribute('aria-hidden', 'false');
      // trap focus to the modal - simple approach: focus the first focusable element
      const first = backdrop.querySelector('input, button, [tabindex="0"]');
      if (first) first.focus();
      document.body.style.overflow = 'hidden';
    }
    function hideModal(backdrop) {
      backdrop.style.display = 'none';
      backdrop.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }

    // Attach click listeners to edit buttons
    document.querySelectorAll('.edit-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.dataset.id;
        const name = btn.dataset.name || '';
        const price = btn.dataset.price || '';
        const quantity = btn.dataset.quantity || '';
        const sellerEmail = btn.dataset.sellerEmail || '';

        // Fill form fields
        editName.value = name;
        editPrice.value = price;
        editQuantity.value = quantity;
        editSeller.value = sellerEmail;

        // Set action for POST /admin/products/edit/:id
        editForm.action = `/admin/products/edit/${id}`;

        showModal(editBackdrop);
      });
    });

    // Edit modal cancel/overlay handlers
    editCancel.addEventListener('click', () => hideModal(editBackdrop));
    editBackdrop.addEventListener('click', (e) => {
      if (e.target === editBackdrop) hideModal(editBackdrop);
    });

    // Attach click listeners to delete buttons
    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.dataset.id;
        const name = btn.dataset.name || 'this product';

        // Update confirmation message
        deleteMsg.textContent = `Are you sure you want to permanently delete "${name}"? This action cannot be undone.`;

        // Set delete form action
        deleteForm.action = `/admin/products/delete/${id}`;

        showModal(deleteBackdrop);
      });
    });

    // Delete cancel/overlay handlers
    deleteCancel.addEventListener('click', () => hideModal(deleteBackdrop));
    deleteBackdrop.addEventListener('click', (e) => {
      if (e.target === deleteBackdrop) hideModal(deleteBackdrop);
    });

    // Close modals with Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (editBackdrop.style.display === 'flex') hideModal(editBackdrop);
        if (deleteBackdrop.style.display === 'flex') hideModal(deleteBackdrop);
      }
    });

  </script>

</body>
</html>
